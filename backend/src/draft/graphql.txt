import express, { Request, Response, NextFunction } from "express";
import bodyParser from "body-parser";
import axios, { AxiosResponse } from "axios";
import { ContactValues } from "../types";

const router = express.Router();

router.use(bodyParser.json());

const mondayAPI = axios.create({
  baseURL: "http://localhost:3000/hikes/allhikes",
});

const query = "{ boards (limit:5) {name id} }";
const query2 =
  "{boards(limit:1) { name id description items { name column_values{title id type text } } } }";

const query3 =
  'mutation{ create_item (board_id:2584878813, item_name:"WHAT IS UP MY FRIENDS!") { id } }';

const query4 =
  "mutation ($myItemName: String!) { create_item (board_id:2584878813, item_name:$myItemName) { id } }";
const vars = { myItemName: "Hello, world!" };

const query5 =
  "mutation ($myItemName: String!, $columnVals: JSON!) { create_item (board_id:2584907448, item_name:$myItemName, column_values:$columnVals) { id } }";
const vars2 = {
  myItemName: "Hello!",
  columnVals: JSON.stringify({
    text: "First Last",
    long_text3: { text: "bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb" },
    text1: "admin@email.com",
    long_text: { text: "imgURL" },
  }),
};
export const handleIntegration = async (contact: ContactValues) => {
  console.log(contact.fullname);
  const vars = {
    myItemName: contact.title,
    columnVals: JSON.stringify({
      text: contact.fullname,
      long_text3: { text: contact.text },
      text1: contact.email,
      long_text: { text: "urll99999lll" },
    }),
  };

  const addToBoard: AxiosResponse = await axios.post(
    "https://api.monday.com/v2",
    {
      query: query5,
      variables: JSON.stringify(vars),
    },
    {
      headers: {
        "Content-Type": "application/json",
        Authorization:
          "eyJhbGciOiJIUzI1NiJ9.eyJ0aWQiOjE1NzE4NzkxOCwidWlkIjoyODY2MjMxOCwiaWFkIjoiMjAyMi0wNC0yNFQxMDoyNDoyNi4wNTNaIiwicGVyIjoibWU6d3JpdGUiLCJhY3RpZCI6MTEwMjMyOCwicmduIjoidXNlMSJ9.3R7Xde6GJM1PBcvyPsjOkRq5UgBFUaFIvN5TrxyEFEU",
      },
    }
  );
};

router.post("/", (req: Request, res: Response, next: NextFunction) => {
  console.log(req.body);
  handleIntegration(req.body);
});

export default router;
